{% load format_date %}

<table class="review-list empty margin-top-1">
	<thead>
		<tr>
		<th colspan={% if hide_headings %}4{% else %}2{% endif %}>{{ title|default:'Documents' }}
				{% if hide_headings and not editable %}
					{% if not submission.organisation_case_role_outer.validated_at %}
						<span  class="pull-right">Publication available after verification</span>
					{% else %}
						{% if not submission.issued_at %}
							{% if user.permissions.publish_public %}<button class="link pull-right" type value="publish-start">
								Publish current version</button>
							{% endif %}
						{% else %}
							{% if user.permissions.publish_public %}
								<button type="button" class="link pull-right" name="btn-value" value="withdraw"
								>Withdraw</button>
							{% endif %}
							<span class="font-weight-normal pull-right"><i class="icon icon-green-tick"></i><strong class="bold">Published</strong> {% if submission.deficiency_notice_params.issue_anonymously == 'yes'%}(anonymous) {% endif %}{{submission.issued_at|format_date:'{S} %b %Y'}} by {{submission.issued_by.name}}</span>
						{% endif %}
					{% endif %}
				{% endif %}
		</th>
		{% if not hide_headings %}
			<th>Status</th>
			<th><span class="pull-right">Sufficient?</span></th>
		{% endif %}
		</tr>
	</thead>
    <tbody>
    {% if documents %}
	    {% for document in documents %}
	        <tr data-fileid="{{document.id}}" data-filename="{{document.name}}" data-filesize="{{document.size}}" data-fileconfidential="{{document.confidential}}">
	        	<td class="small"><span class="file-count">{{ forloop.counter }}.</span></td>
	            <td>
	                <span class="filename">{% document_link document %}</span>
	            </td>
	            <td>
	           		{% if document.parent.checksum == document.checksum %}
	           			&nbsp;
	           		{% elif document.parent.deficient %}
	           		    Deficient/replaced
	           		{% elif document.parent %}
	           			Replaced
	           		{% else %}
	           			New
	           		{% endif %}
	            </td>
	            <td>
					{% set 'doc_editable' editable %}
	            	{% set 'value' '' %}
	            	{% if document.deficient or not document.safe %}
						{% set 'value' 'no' %}
						{% if document.safe == False %}
							{% set 'doc_editable' False %}
						{% endif %}
	            	{% elif document.sufficient %}
	            		{% set 'value' 'yes' %}
	            	{% endif %}
					{% include 'widgets/slider.html' with value=value name=document.id editable=doc_editable %}
	            </td>
	        </tr>
	    {% endfor %}
	{% else %}
		<tr class="empty-line">
			<td colspan="3" class="text-grey">No files have been added</td>
		</tr>
	{% endif %}
    </tbody>
</table>
